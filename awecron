#!/bin/bash
# Note: the code is very commented for convenience and newbies (not to annoy)

main () {
         # runs through all dirs in the same dir as awecron
        for d in "${BASH_SOURCE%/*}"/*/; do
                 # parentheses are needed to contain variables inside
		(	 # gets the cronjob configuration variables
                	source "$d/config"
                	 # compares the timer with the current epoch time
                	timer=$(<"$d/timer")
                	printf -v time "%(%s)T"
                	if (( timer <= time )); then
                        	 # logs events
                        	printf "awecron %s: %s\n" "$user" "$name"
                        	 # runs the binary with specified user
				su "$user" -c "$d/bin"
                        	 # sets the timer
                        	printf $(( time + intr )) > "$d/timer"
                	fi
		)
	done	
}

while true; do
        main
         # frequency of cron
        sleep 60
done
